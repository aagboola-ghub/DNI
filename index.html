<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DNI Demo — Wells Fargo (SERP → Site)</title>

  <!-- Minimal offline styles (no CDN) -->
  <style>
    :root{
      --brand-red:#d2232a; --brand-green:#1e7a33; --panel:#0d6efd; --muted:#6c757d;
      --bg:#f6f7f9; --card:#fff; --border:#e5e7eb; --text:#111827; --soft:#f1f5f9;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    a{color:#0d6efd;text-decoration:none}
    .bar{background:var(--brand-red);color:#fff;height:56px;display:flex;align-items:center;padding:0 16px;font-weight:700;font-size:18px;position:sticky;top:0;z-index:10}
    .bar .pill{height:6px;background:var(--brand-green);width:200px;position:absolute;bottom:-6px;left:0}
    .wrap{display:grid;grid-template-columns:320px 1fr;gap:16px;padding:16px;max-width:1400px;margin:0 auto}
    .card{background:var(--card);border:1px solid var(--border);border-radius:8px;box-shadow:0 1px 0 rgba(0,0,0,.03)}
    .card+.card{margin-top:12px}
    .card-header{padding:10px 12px;border-bottom:1px solid var(--border);background:var(--soft);font-weight:700}
    .card-body{padding:12px}
    .btn{display:inline-block;padding:8px 12px;border-radius:6px;border:1px solid #cbd5e1;background:#fff;cursor:pointer}
    .btn.primary{background:#0d6efd;color:#fff;border-color:#0d6efd}
    .btn.danger{background:#ef4444;color:#fff;border-color:#ef4444}
    .btn.block{width:100%;text-align:center}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .row .btn{flex:1 1 auto}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px 10px;border-top:1px solid var(--border);vertical-align:top}
    th{font-weight:600;text-align:left;width:34%}
    .muted{color:var(--muted)}
    .address-bar{padding:8px 10px;border:1px solid var(--border);border-radius:6px;background:#fff;font-family:ui-monospace,Consolas,monospace;margin:8px}
    .searchbox{display:flex;gap:10px;padding:8px 10px}
    .searchbox input{flex:1 1 auto;padding:10px;border:1px solid var(--border);border-radius:6px}
    .result{border:1px solid var(--border);border-radius:8px;background:#fff;margin:12px 8px;padding:12px}
    .result.ad{border-left:4px solid #f59e0b}
    .result .title{font-size:18px;font-weight:700;margin-bottom:6px}
    .result .site{font-size:12px;color:#065f46;margin-bottom:4px}
    .badge{display:inline-block;background:#fee2e2;color:#b91c1c;border:1px solid #fecaca;border-radius:999px;padding:2px 8px;font-size:12px;margin-right:8px}
    .site{display:none}
    .site.active{display:block}
    .serp{display:block}
    .serp.hidden{display:none}
    .nav-tabs{display:flex;gap:16px;border-bottom:1px solid var(--border);padding:0 12px}
    .nav-tabs a{padding:10px 0;color:#111827}
    .kpi{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;margin-top:12px}
    .kpi .card{padding:10px}
    .cta{margin-top:12px}
    .phone{font-weight:700}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .controls-title{background:#0d6efd;color:#fff;border-radius:8px 8px 0 0;padding:12px;font-size:16px;font-weight:700}
    .controls{border:1px solid var(--border);border-top:0;border-radius:0 0 8px 8px;background:#fff;padding:12px}
    .controls h4{margin:8px 0 6px 0;font-size:14px}
    .controls .row{margin-bottom:10px}
    .left-col{position:sticky;top:72px;height:calc(100vh - 88px);overflow:auto;padding-right:6px}
  </style>
</head>
<body>
  <div class="bar">Wells Fargo Business Banking<div class="pill"></div></div>

  <div class="wrap">
    <!-- LEFT COLUMN -->
    <div class="left-col">
      <div class="controls-title">Demo Controls</div>
      <div class="controls card-body">
        <h4>1. Select Traffic Source:</h4>
        <div class="row">
          <button class="btn" data-source="google">Google</button>
          <button class="btn" data-source="facebook">Facebook</button>
          <button class="btn" data-source="microsoft">Microsoft</button>
        </div>

        <h4>2. Select Marketing Type:</h4>
        <div class="row">
          <button class="btn" data-campaign="paid">Paid Campaign</button>
          <button class="btn" data-campaign="organic">Organic Search</button>
        </div>

        <h4>3. Select Tracking Type:</h4>
        <div class="row">
          <button class="btn" data-track="session">Session Tracking</button>
          <button class="btn" data-track="channel">Channel Tracking</button>
        </div>

        <div class="cta">
          <button class="btn danger block" id="reset-demo">Reset Demo</button>
        </div>
      </div>

      <!-- Call Tracking -->
      <div class="card" id="tracking-details-card">
        <div class="card-header">Call Tracking</div>
        <div class="card-body" style="padding:0">
          <table class="table table-sm mb-0">
            <tbody>
              <tr><th>Traffic Source</th><td id="traffic-source">—</td></tr>
              <tr><th>UTM Source</th><td id="utm-source">—</td></tr>
              <tr><th>UTM Medium</th><td id="utm-medium">—</td></tr>
              <tr><th>UTM Campaign</th><td id="utm-campaign">—</td></tr>
              <tr><th>UTM Term</th><td id="utm-term">—</td></tr>
              <tr><th>Click ID</th><td id="click-id">—</td></tr>
              <tr><th>Landing Page</th><td id="landing-page">—</td></tr>
              <tr><th>Original Number</th><td id="original-number">—</td></tr>
              <tr>
                <th>Tracking Number</th>
                <td><a id="tracking-number-link" href="#"><span id="tracking-number">—</span></a></td>
              </tr>
              <tr><th>Campaign Type</th><td id="campaign-type">—</td></tr>
              <tr><th>Tracking Type</th><td id="tracking-mode">—</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Call Analytics -->
      <div class="card" id="call-analytics-card" style="display:none">
        <div class="card-header">Call Analytics</div>
        <div class="card-body" id="call-analytics-body">
          <div class="muted small">Simulate a call to see attribution.</div>
        </div>
      </div>
    </div>

    <!-- RIGHT COLUMN -->
    <div>
      <!-- SERP (pre-click) -->
      <div class="serp" data-page="serp" id="serp">
        <div class="address-bar">www.google.com/search?q=small+business+checking+account</div>
        <div class="searchbox">
          <input type="search" value="small business checking account" aria-label="Search"/>
          <button class="btn primary">Search</button>
        </div>

        <div class="result ad" data-nav="ad">
          <div class="badge">Ad</div>
          <div class="title"><a class="result-link" href="#" data-nav="ad">Small Business Checking | Wells Fargo</a></div>
          <div class="site">wellsfargo.com/biz/</div>
          <div class="desc">Open a Business Checking Account with Wells Fargo. Enjoy Online Banking, Mobile App & Trusted Support.</div>
        </div>

        <div class="result result-organic">
          <div class="title"><a class="result-link" href="#" data-nav="organic">Best Small Business Checking Accounts of 2025</a></div>
          <div class="site">www.nerdwallet.com/best/banking/business-checking-accounts</div>
          <div class="desc">Compare the best small business checking accounts from top banks and credit unions.</div>
        </div>

        <div class="result result-organic">
          <div class="title"><a class="result-link" href="#" data-nav="organic">Business Checking Accounts | Bank of America</a></div>
          <div class="site">www.bankofamerica.com/smallbusiness/banking/checking-accounts/</div>
          <div class="desc">Open a small business checking account from Bank of America.</div>
        </div>
      </div>

      <!-- SITE (post-click) -->
      <div class="site" id="site">
        <div class="nav-tabs">
          <a href="#">Home</a><a href="#">Checking</a><a href="#">Savings</a><a href="#">Loans</a><a href="#">Merchant Services</a>
          <a href="#" class="muted back-to-results" id="back-to-results" style="margin-left:auto">Back to results</a>
        </div>

        <div class="card" style="margin-top:12px">
          <div class="card-body">
            <h2 style="margin:0 0 6px 0">Let's Grow Your Business, Together</h2>
            <div class="muted">Find the right financial solutions for your business needs.</div>
            <div class="cta"><button class="btn primary" data-action="visit-site">Explore Business Checking</button></div>
          </div>
        </div>

        <div class="grid" style="margin-top:12px">
          <div class="card"><div class="card-body">
            <div class="muted">Talk to a Business Banker:</div>
            <div class="phone"><a href="#" class="dni-link"><span class="dni-number" data-dni>800-000-0000</span></a></div>
          </div></div>
          <div class="card"><div class="card-body">
            <div class="muted">Questions? Call:</div>
            <div class="phone"><a href="#" class="dni-link"><span class="dni-number" data-dni>800-000-0000</span></a></div>
          </div></div>
        </div>

        <div class="cta">
          <button class="btn primary" id="simulate-call" data-simulate-call>Simulate Call</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Offline JS: state, engine, strict SERP gating, friendly analytics -->
  <script>
  (function(){
    // ---------- STATE & CONFIG (offline, deterministic)
    window.__state = { source:'google', campaignType:'paid', trackingMode:'session' };
    window.__cfg = {
      attribution:{
        utm_campaign:'bizbanking_2025_q2',
        utm_term:'small business checking account',
        landing_page_url:'wellsfargo.com/biz/checking/initiate/'
      },
      features:{ fbclidOnOrganic:false },
      dniRules:[
        { when:{ source:'google',    medium:'cpc'     }, number:'+1 (555) 010-1001' },
        { when:{ source:'google',    medium:'organic' }, number:'+1 (555) 010-1002' },
        { when:{ source:'bing',      medium:'cpc'     }, number:'+1 (555) 010-2001' },
        { when:{ source:'bing',      medium:'organic' }, number:'+1 (555) 010-2002' },
        { when:{ source:'facebook',  medium:'paid_social' }, number:'+1 (555) 010-3001' },
        { when:{ source:'facebook',  medium:'social'  }, number:'+1 (555) 010-3002' },
        { when:{ source:'direct'                      }, number:'+1 (555) 010-9000' }
      ]
    };

    // ---------- Utilities
    const $ = (s,root=document)=>root.querySelector(s);
    const $$ = (s,root=document)=>Array.from(root.querySelectorAll(s));
    const text = (id,val)=>{ const n=document.getElementById(id); if(n) n.textContent=val; };
    const dashAll = ()=>{
      ['traffic-source','utm-source','utm-medium','utm-campaign','utm-term','click-id','landing-page','original-number','tracking-number','campaign-type','tracking-mode']
      .forEach(id=>text(id,'—'));
      const link=$('#tracking-number-link'); if(link) link.removeAttribute('href');
    };
    const isSerp = ()=>!!document.querySelector('.serp:not(.hidden)');

    // ---------- DNI core (minimal)
    function mapSourceForUtm(src){ return src==='microsoft' ? 'bing' : src || 'direct'; }
    function resolveMedium(state){
      if(state.source==='facebook') return state.campaignType==='paid'?'paid_social':'social';
      return state.campaignType==='paid'?'cpc':'organic';
    }
    window.resolveNumber = function(rules, state){
      const src = mapSourceForUtm(state.source);
      const med = resolveMedium(state);
      // channel vs session behaviors can be expanded; simple match is fine here
      const hit = rules.find(r=>{
        const w=r.when||{};
        return (!w.source || w.source===src) && (!w.medium || w.medium===med);
      }) || rules.find(r=> (r.when||{}).source==='direct') || {number:''};
      return hit.number || '';
    };

    function applyToDom(number){
      $$('.dni-number').forEach(el=>el.textContent = number || el.textContent);
      $$('.dni-link').forEach(a=>{ if(number){ a.setAttribute('href', 'tel:' + number.replace(/\D/g,'')); } });
      text('original-number','—'); // for completeness
    }
    function mapLabels(state){
      const utmSource = mapSourceForUtm(state.source);
      const utmMedium = resolveMedium(state);
      return {utmSource, utmMedium,
        campaignLabel: state.campaignType==='paid'?'Paid Search':'Organic Search',
        trackingLabel: state.trackingMode==='channel'?'Channel Tracking':'Session Tracking'};
    }

    // ---------- STRICT SERP GATING + RENDER
    window.renderTrackingDetails = function(config, state, number){
      if(isSerp()){ dashAll(); return; } // All blank on SERP
      const {utmSource, utmMedium, campaignLabel, trackingLabel} = mapLabels(state);
      const attr = (config && config.attribution)||{};
      const campaign = attr.utm_campaign || '—';
      const term     = attr.utm_term || '';
      const lp       = attr.landing_page_url || (location.hostname + location.pathname);
      let clickId='—';
      if(state.source==='google' && state.campaignType==='paid') clickId='gclid=demo';
      if(state.source==='microsoft' && state.campaignType==='paid') clickId='msclkid=demo';
      if(state.source==='facebook' && (state.campaignType==='paid' || ((config.features||{}).fbclidOnOrganic===true))) clickId='fbclid=demo';

      text('traffic-source', utmSource);
      text('utm-source', utmSource);
      text('utm-medium', utmMedium);
      text('utm-campaign', campaign);
      text('utm-term', term);
      text('click-id', clickId);
      text('landing-page', lp);
      text('campaign-type', campaignLabel);
      text('tracking-mode', trackingLabel);

      const tn = number || '—';
      text('tracking-number', tn);
      const link=$('#tracking-number-link'); if(link && number) link.setAttribute('href','tel:'+number.replace(/\D/g,''));
    };

    window.updateNumber = function(config,state){
      if(isSerp()){ dashAll(); return; }
      const n = resolveNumber((config||{}).dniRules||[], state||{});
      renderTrackingDetails(config,state,n);
      if(n) applyToDom(n);
    };

    // ---------- Call Analytics (left card + modal if present)
    function fmtPhone(s){ const d=(s||'').replace(/[^\d]/g,''); if(d.length===11 && d[0]==='1') return `+1 ${d.slice(1,4)}-${d.slice(4,7)}-${d.slice(7)}`; if(d.length===10) return `(${d.slice(0,3)}) ${d.slice(3,6)}-${d.slice(6)}`; return s||''; }
    function readCell(id){ return (document.getElementById(id)?.textContent||'').trim(); }
    function renderFriendlyAnalytics(payload){
      const items=[
        ['The UTM campaign', payload.attribution_details.utm_campaign],
        ['The UTM source',   payload.attribution_details.utm_source],
        ['The UTM medium',   payload.attribution_details.utm_medium],
        ['The UTM term/keyword', payload.attribution_details.utm_term],
        ['The UTM content',  payload.attribution_details.utm_content||''],
        ['The landing page URL', payload.attribution_details.landing_page_url],
        ['Start date and time', new Date(payload.start_time).toLocaleString()],
        ['Duration of call in seconds', String(payload.call_duration)],
        ['Tracking number', fmtPhone(payload.tracking_number)],
        ["Caller's phone number", fmtPhone(payload.caller_number)]
      ];
      const html = items.map(([k,v])=>`<div class="d-flex justify-content-between border-bottom py-1"><div class="me-3"><strong>${k}</strong></div><div class="text-break">${v||''}</div></div>`).join('');
      const left = $('#call-analytics-body'); if(left){ left.innerHTML=html; left.closest('#call-analytics-card').style.display=''; }
      const modalBody = document.querySelector('.modal.show .modal-body'); if(modalBody) modalBody.innerHTML = html;
    }

    // ---------- Controls & Wiring
    function goSerp(){ $('#serp').classList.remove('hidden'); $('#site').classList.remove('active'); $('#site').style.display='none'; $('#serp').style.display='block'; dashAll(); }
    function goSite(){ $('#serp').classList.add('hidden'); $('#site').style.display='block'; $('#site').classList.add('active'); updateNumber(__cfg,__state); }

    // Toggle buttons
    $$('#serp .result a.result-link').forEach(a=>a.addEventListener('click',(e)=>{ e.preventDefault(); goSite(); }));
    $('#back-to-results').addEventListener('click',(e)=>{ e.preventDefault(); goSerp(); });

    // Source / campaign / tracking toggles
    $$('.controls [data-source]').forEach(b=>b.onclick=()=>{ __state.source=b.getAttribute('data-source'); if(!isSerp()) updateNumber(__cfg,__state); });
    $$('.controls [data-campaign]').forEach(b=>b.onclick=()=>{ __state.campaignType=b.getAttribute('data-campaign'); if(!isSerp()) updateNumber(__cfg,__state); });
    $$('.controls [data-track]').forEach(b=>b.onclick=()=>{ __state.trackingMode=b.getAttribute('data-track'); if(!isSerp()) updateNumber(__cfg,__state); });

    $('#reset-demo').addEventListener('click',()=>{ __state={source:'google',campaignType:'paid',trackingMode:'session'}; goSerp(); });

    // Simulate Call → build payload from current UI + cells
    $('#simulate-call').addEventListener('click',()=>{
      const attr = __cfg.attribution||{};
      const payload={
        attribution_details:{
          utm_campaign: attr.utm_campaign || readCell('utm-campaign') || '—',
          utm_source:   mapSourceForUtm(__state.source),
          utm_medium:   resolveMedium(__state),
          utm_term:     attr.utm_term || readCell('utm-term') || '',
          utm_content:  attr.utm_content || '',
          landing_page_url: attr.landing_page_url || readCell('landing-page') || (location.hostname+location.pathname)
        },
        start_time: new Date().toISOString(),
        call_duration: 268,
        tracking_number: readCell('tracking-number') || '',
        caller_number: '+15559876543'
      };
      renderFriendlyAnalytics(payload);
    });

    // First paint: SERP with blanks
    goSerp();
  })();
  </script>
</body>
</html>
